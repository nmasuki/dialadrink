!function(n){n.fn.gMap=function(e,o){switch(e){case"addMarker":return n(this).trigger("gMap.addMarker",[o.latitude,o.longitude,o.content,o.icon,o.popup]);case"centerAt":return n(this).trigger("gMap.centerAt",[o.latitude,o.longitude,o.zoom]);case"clearMarkers":return n(this).trigger("gMap.clearMarkers")}var p=n.extend({},n.fn.gMap.defaults,e);return this.each(function(){var d=new google.maps.Map(this);n(this).data("gMap.reference",d);var e=new google.maps.Geocoder;p.address?e.geocode({address:p.address},function(e,o){e&&e.length&&d.setCenter(e[0].geometry.location)}):p.latitude&&p.longitude?d.setCenter(new google.maps.LatLng(p.latitude,p.longitude)):n.isArray(p.markers)&&0<p.markers.length?p.markers[0].address?e.geocode({address:p.markers[0].address},function(e,o){e&&0<e.length&&d.setCenter(e[0].geometry.location)}):d.setCenter(new google.maps.LatLng(p.markers[0].latitude,p.markers[0].longitude)):d.setCenter(new google.maps.LatLng(34.885931,9.84375)),d.setZoom(p.zoom),d.setMapTypeId(google.maps.MapTypeId[p.maptype]);var o={scrollwheel:p.scrollwheel,disableDoubleClickZoom:!p.doubleclickzoom};!1===p.controls?n.extend(o,{disableDefaultUI:!0}):0!=p.controls.length&&n.extend(o,p.controls,{disableDefaultUI:!0}),d.setOptions(o);var l=new google.maps.Marker;marker_icon=new google.maps.MarkerImage(p.icon.image),marker_icon.size=new google.maps.Size(p.icon.iconsize[0],p.icon.iconsize[1]),marker_icon.anchor=new google.maps.Point(p.icon.iconanchor[0],p.icon.iconanchor[1]),l.setIcon(marker_icon),p.icon.shadow&&(marker_shadow=new google.maps.MarkerImage(p.icon.shadow),marker_shadow.size=new google.maps.Size(p.icon.shadowsize[0],p.icon.shadowsize[1]),marker_shadow.anchor=new google.maps.Point(p.icon.shadowanchor[0],p.icon.shadowanchor[1]),l.setShadow(marker_shadow)),n(this).bind("gMap.centerAt",function(e,o,a,r){r&&d.setZoom(r),d.panTo(new google.maps.LatLng(parseFloat(o),parseFloat(a)))});var c,m=[];n(this).bind("gMap.clearMarkers",function(){for(;m[0];)m.pop().setMap(null)}),n(this).bind("gMap.addMarker",function(e,o,a,r,n,s){var t=new google.maps.LatLng(parseFloat(o),parseFloat(a)),i=new google.maps.Marker({position:t});if(n?(marker_icon=new google.maps.MarkerImage(n.image),marker_icon.size=new google.maps.Size(n.iconsize[0],n.iconsize[1]),marker_icon.anchor=new google.maps.Point(n.iconanchor[0],n.iconanchor[1]),i.setIcon(marker_icon),n.shadow&&(marker_shadow=new google.maps.MarkerImage(n.shadow),marker_shadow.size=new google.maps.Size(n.shadowsize[0],n.shadowsize[1]),marker_shadow.anchor=new google.maps.Point(n.shadowanchor[0],n.shadowanchor[1]),l.setShadow(marker_shadow))):(i.setIcon(l.getIcon()),i.setShadow(l.getShadow())),r){"_latlng"==r&&(r=o+", "+a);var g=new google.maps.InfoWindow({content:p.html_prepend+r+p.html_append});google.maps.event.addListener(i,"click",function(){c&&c.close(),g.open(d,i),c=g}),s&&google.maps.event.addListenerOnce(d,"tilesloaded",function(){g.open(d,i)})}i.setMap(d),m.push(i)});for(var a=0;a<p.markers.length;a++)marker=p.markers[a],marker.address?("_address"==marker.html&&(marker.html=marker.address),e.geocode({address:marker.address},function(a,r){return function(e,o){e&&0<e.length&&n(r).trigger("gMap.addMarker",[e[0].geometry.location.lat(),e[0].geometry.location.lng(),a.html,a.icon,a.popup])}}(marker,this))):n(this).trigger("gMap.addMarker",[marker.latitude,marker.longitude,marker.html,marker.icon,marker.popup])})},n.fn.gMap.defaults={address:"",latitude:0,longitude:0,zoom:1,markers:[],controls:[],scrollwheel:!1,doubleclickzoom:!0,maptype:"ROADMAP",html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",shadow:"http://www.google.com/mapfiles/shadow50.png",iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}}(jQuery);