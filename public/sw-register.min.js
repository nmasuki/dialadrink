var applicationServerPublicKey=window.vapidPublicKey;function urlB64ToUint8Array(e){for(var o=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(o),n=new Uint8Array(i.length),r=0;r<i.length;++r)n[r]=i.charCodeAt(r);return n}function getCookie(e){var o=document.cookie.indexOf(e)+e.length+1,i=document.cookie.indexOf(";",o);return document.cookie.substr(o,(i<0?document.cookie.length:i)-o)}function updateSubscriptionOnServer(e){console.log("Sending subscription data fo Server!",e),fetch("/api/user/webpush",{method:"POST",body:JSON.stringify(e||{}),headers:{"content-type":"application/json","X-Requested-With":"xmlhttprequest","X-CSRF-Token":getCookie("XSRF-TOKEN")}}).then(function(e){console.log("Subscription data sent!",e)}).catch(function(e){console.warn("Error sending subscription!",e)})}function subscribeToPushNotification(e){console.log("Subscribing user to push notifications"),e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:urlB64ToUint8Array(applicationServerPublicKey)}).then(function(e){console.log("Subscription OK!"),updateSubscriptionOnServer(e)}).catch(function(e){console.log("Failed to subscribe the user: ",e)})}function initializePush(o){o.pushManager.getSubscription().then(function(e){e?(console.log("User already subscribed."),updateSubscriptionOnServer(e)):(console.log("User is NOT subscribed."),window.subscribeToPushNotification=function(){"denied"===Notification.permission?(console.log("Push Messaging Blocked."),updateSubscriptionOnServer(null)):subscribeToPushNotification(o),delete window.subscribeToPushNotification})})}"serviceWorker"in navigator&&(console.log("Service Worker is supported!"),window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(e){console.log("Service Worker is registered",e),"PushManager"in window?(console.log("Push is supported!"),setTimeout(function(){initializePush(e)},5e3)):console.warn("Push messaging is not supported")}).catch(function(e){console.error("Service Worker Error",e)})}));